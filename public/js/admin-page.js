"use strict";

function loadEventListenersAdmin(){
    document.querySelectorAll(".enable").forEach(e => {
        e.addEventListener("click", enable);
    });
    document.querySelectorAll(".disable").forEach(e => {
        e.addEventListener("click", disable);
    });

    document.querySelectorAll(".select-screen li").forEach(e => {
        e.addEventListener("click", changeScreen);
    });
}

function changeScreen(e) {
    e.target.classList.add("selected");
    let selected = document.querySelector(".selected");
    selected.classList.remove("selected");

    let current_users = document.querySelector("#CURRENT_USERS_ONLINE")
    let all_users = document.querySelector("#ALL_USERS")
    let disable_users = document.querySelector("#DISABLE_USERS")

    if(selected.innerHTML === current_users.id){
        getAllOnlineUsers();
        current_users.classList.remove("hidden");
        all_users.classList.add("hidden");
        disable_users.classList.add("hidden");
    }
    else if(selected.innerHTML === all_users.id){
        getAllUsers();
        current_users.classList.add("hidden");
        all_users.classList.remove("hidden");
        disable_users.classList.add("hidden");
    }
    else{
        getAllUsersToEnable();
        current_users.classList.add("hidden");
        all_users.classList.add("hidden");
        disable_users.classList.remove("hidden");
    }
}


function getAllOnlineUsers(){
    const $loc = document.querySelector("#CURRENT_USERS_ONLINE .table-input");
    $loc.innerHTML = "";
    fetchFromServer('/api/users', 'GET')
        .then(json =>{
            json.forEach(item => {
                if(item.Status === 200){
                    let statusText = convertNumberToText(item.Status);
                    $loc.innerHTML += ` <ul>
                                        <li class=${statusText}>${item.Username}</li>
                                        <li>${item.Status}</li>
                                        <li>${item.Score}</li>
                                    </ul>`;
                }
            });
        });
}
function getAllUsers() {
    const $loc = document.querySelector("#ALL_USERS .table-input");
    $loc.innerHTML = "";
    fetchFromServer('/api/users', 'GET')
        .then(json =>{
            json.forEach(item => {
                let statusText = convertNumberToText(item.Status);
                $loc.innerHTML += ` <ul>
                                        <li class=${statusText}>${item.Username}</li>
                                        <li>${item.Status}</li>
                                        <li>${item.Score}</li>
                                    </ul>`;
            });
        });
}
function getAllUsersToEnable(){
    const $loc = document.querySelector("#DISABLE_USERS .table-input");
    $loc.innerHTML = "";
    fetchFromServer('/api/users', 'GET')
        .then(json => {
            json.forEach(item => {
                if (item.Status === 200 || item.Status === 404) {
                    $loc.innerHTML += getEnableUserHTML(item);
                } else {
                    $loc.innerHTML += getDisableUserHTML(item);
                }
                loadEventListenersAdmin();
            });
        });
}

function getEnableUserHTML(item){
    let statusText = convertNumberToText(item.Status);
    return ` <ul>
                <li class=${statusText}>${item.Username}</li>
                <li>${item.Status}</li>
                <li>${item.Score}</li>
                <li class="disable">DISABLE</li>
            </ul>`;
}
function getDisableUserHTML(item){
    let statusText = convertNumberToText(item.Status);
    return ` <ul>
                <li class=${statusText}>${item.Username}</li>
                <li>${item.Status}</li>
                <li>${item.Score}</li>
                <li class="enable">ENABLE</li>
            </ul>`;
}

function convertNumberToText(input){
    if(input === 200){
        return "twohundred";
    }
    else if (input === 404){
        return "fourofour";
    }
    else{
        return "fourfiveone";
    }
}


function enable(e){
    e.target.innerHTML = "DISABLE";
    e.target.classList.replace("enable", "disable");
    loadEventListenersAdmin();
    fetch('/api/users/online', {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'id': 5
        }
    });
}

function disable(e){
    e.target.innerHTML = "ENABLE";
    e.target.classList.replace("disable", "enable");
    loadEventListenersAdmin();
    fetch('/api/users/timeout', {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'id': 2
        }
    });
}
